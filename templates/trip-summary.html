{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asoniya Platform - Trip Summary</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    {% include 'components/header.html' %}

    <section class="trip-summary py-5">
        <div class="container">
            <h2 class="text-center mb-4">Your Trip Summary</h2>

            <div class="summary-section mb-4">
                <h3 class="section-title mb-4">
                    <i class="fas fa-map-marked-alt mr-2"></i>Selected Attractions
                </h3>
                <div id="attractions-summary-list" class="list-group">
                    <p>Loading attractions...</p>
                </div>
            </div>

            <div class="summary-section mb-4">
                <h3 class="section-title mb-4">
                    <i class="fas fa-concierge-bell mr-2"></i>Selected Services
                </h3>
                <div class="row">
                    <div class="col-md-4">
                        <h4><i class="fas fa-bed mr-2"></i>Accommodations</h4>
                        <ul id="accommodations-summary-list" class="list-group"></ul>
                    </div>
                    <div class="col-md-4">
                        <h4><i class="fas fa-car mr-2"></i>Car Rentals</h4>
                        <ul id="cars-summary-list" class="list-group"></ul>
                    </div>
                    <div class="col-md-4">
                        <h4><i class="fas fa-user-tie mr-2"></i>Travel Agencies</h4>
                        <ul id="agencies-summary-list" class="list-group"></ul>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons text-center mt-4">
                </div>
        </div>
    </section>

    {% include 'components/footer.html' %}

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/trip/summary/')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Please log in to see your trip summary.');
                    }
                    return response.json();
                })
                .then(data => {
                    // Populate Attractions
                    const attractionsList = document.getElementById('attractions-summary-list');
                    attractionsList.innerHTML = '';
                    if (data.attractions && data.attractions.length > 0) {
                        data.attractions.forEach(item => {
                            const listItem = `<a href="#" class="list-group-item list-group-item-action">${item.name}</a>`;
                            attractionsList.innerHTML += listItem;
                        });
                    } else {
                        attractionsList.innerHTML = '<p>No attractions selected.</p>';
                    }

                    // Populate Accommodations
                    const accommodationsList = document.getElementById('accommodations-summary-list');
                    accommodationsList.innerHTML = '';
                    if (data.accommodations && data.accommodations.length > 0) {
                        data.accommodations.forEach(item => {
                            const listItem = `<li class="list-group-item">${item.name}</li>`;
                            accommodationsList.innerHTML += listItem;
                        });
                    } else {
                        accommodationsList.innerHTML = '<li class="list-group-item">No accommodations selected.</li>';
                    }
                    // Populate Car Rentals
                    const carsList = document.getElementById('cars-summary-list');
                    carsList.innerHTML = '';
                    if (data.car_rentals && data.car_rentals.length > 0) {
                        data.car_rentals.forEach(item => {
                            const listItem = `<li class="list-group-item">${item.name}</li>`;
                            carsList.innerHTML += listItem;
                        });
                    } else {
                        carsList.innerHTML = '<li class="list-group-item">No car rentals selected.</li>';
                    }
                    // Populate Travel Agencies
                    const agenciesList = document.getElementById('agencies-summary-list');
                    agenciesList.innerHTML = '';
                    if (data.travel_agencies && data.travel_agencies.length > 0) {
                        data.travel_agencies.forEach(item => {
                            const listItem = `<li class="list-group-item">${item.name}</li>`;
                            agenciesList.innerHTML += listItem;
                        });
                    } else {
                        agenciesList.innerHTML = '<li class="list-group-item">No travel agencies selected.</li>';
                    }
                })
                .catch(error => {
                    const summaryContainer = document.querySelector('.trip-summary .container');
                    summaryContainer.innerHTML = `<div class="alert alert-warning text-center">${error.message}</div>`;
                });
        });
    </script>
</body>
</html>